<html>
<head>
	<title>piPlayer</title>
	<meta charset="UTF-8">
	<style>
		a,p,span { font-size: 60px; font-family: sans-serif; margin : 20px; } 
		.active { cursor: pointer; color: rgb(85,26,139); text-decoration: underline }
		div#scrolling { overflow: auto;  background-color: #cc9; }
	    html, body { overflow: hidden; height: 100% }
        body { margin:0; padding:0; }
		div#top { background-color: #bdd; border-bottom: solid #bdd }
		p.title,.playing { color: green; font-style: italic; text-shadow: 2px 2px #333 }
	</style>
	<script>
	var scrolldiv;
	var topdiv;
	var playingId = false;
	
	function resizeScroller()
	{
	   scrolldiv.style.height = window.innerHeight - topdiv.offsetHeight;
	}
	function placeScroller()
	{
	   topdiv = document.getElementById('top');
	   scrolldiv = document.getElementById('scrolling');
	   scrolldiv.style.top = topdiv.offsetHeight + 1;
	   resizeScroller();
	}
	window.onload = placeScroller;
	window.onresize = resizeScroller;
	
	function xmlrequest(command)
	{
		xmlhttp = new XMLHttpRequest();
		xmlhttp.open("GET","./" + command, true);
		xmlhttp.onreadystatechange = function() {
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
				var resp = xmlhttp.responseText;
				switch (resp)
				{
				case 'paused':
					document.getElementById('pause').innerHTML = 'Unpause';
					break;
				case 'unpaused':
					document.getElementById('pause').innerHTML = 'Pause';
					break;
				case 'stop':
				case 'end':
					// If the playing track was highlighted, unhighlight it.
					elt = document.getElementById(playingId);
					if (elt)
					{
						elt.className = "active";
					}
					playingId = false;
					break;
				default:
					var splitResponse = resp.split(':');
					if (splitResponse.length == 2 && splitResponse[0] == 'playing')
					{
						// Update highlighting of currently playing track.
						var playId = encodeURIComponent(splitResponse[1]);
						if ((playId != playingId) && playingId)
						{
							elt = document.getElementById(playingId);
							if (elt)
							{
								elt.className = "active";
							}
						}
						var elt = document.getElementById(playId);
						if (elt)
						{
							elt.className = "active playing";
							if (elt.offsetTop + elt.offsetHeight > scrolldiv.scrollTop + scrolldiv.offsetHeight)
							{
								// scroll down to keep element in view, if needed
								// Display current track plus preceding one.
								scrolldiv.scrollTop = playingTrackRow.offsetTop - scrolldiv.offsetTop - playingTrackRow.offsetHeight;
							}
						}
						playingId = playId;
						// Listen for end of track / next track.
						xmlrequest('monitor');
					}
					else
					{
						alert('responseText = ' + resp);
					}
				}
			}
		};
		xmlhttp.send();
	} // xmlrequest
	
	function initPlaying()
	{
		playingId = document.getElementsByTagName("BODY")[0].getAttribute("playing");
		xmlrequest("./monitor");
		var playingTrackRow = document.getElementById(playingId);
		if (playingTrackRow)
		{
			// Display current track plus preceding one.
			scrolldiv.scrollTop = playingTrackRow.offsetTop - scrolldiv.offsetTop - playingTrackRow.offsetHeight;
		}
	}
	</script>
</head>

